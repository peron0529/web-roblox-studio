<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Studio (Lite)</title>
  <style>
    body { margin:0; font-family: system-ui; background:#0b0f16; color:#e7eefc; }
    .top { height:48px; display:flex; align-items:center; gap:8px; padding:0 12px; border-bottom:1px solid #23304a; }
    .grid { height: calc(100vh - 48px); display:grid; grid-template-columns:260px 1fr 320px; }
    .panel { padding:10px; border-right:1px solid #23304a; }
    .panel.right { border-right:0; border-left:1px solid #23304a; }
    .card { border:1px solid #23304a; border-radius:12px; padding:10px; background:#0f1626; }
    button { background:#2a3b5f; color:#e7eefc; border:0; padding:8px 10px; border-radius:10px; cursor:pointer; }
    button:hover { filter:brightness(1.1); }
    .item { padding:6px 8px; border-radius:8px; cursor:pointer; }
    .item.active { background:#2a3b5f; }
    input { width:100%; padding:8px; border-radius:10px; border:1px solid #23304a; background:#0b0f16; color:#e7eefc; }
    textarea { width:100%; height:220px; padding:8px; border-radius:10px; border:1px solid #23304a; background:#0b0f16; color:#e7eefc; }
  </style>
</head>
<body>
  <div class="top">
    <b>Web Studio (Lite)</b>
    <button id="add">+ Part</button>
    <button id="save">Save</button>
    <button id="load">Load</button>
  </div>

  <div class="grid">
    <div class="panel">
      <b>Explorer</b>
      <div id="explorer" class="card" style="margin-top:8px;"></div>
    </div>

    <div class="panel">
      <b>Viewport (あとで3Dにできる)</b>
      <div class="card" style="margin-top:8px; height: calc(100% - 28px); display:flex; align-items:center; justify-content:center; opacity:.8;">
        ここは今はプレースホルダー（2D/3Dは後で）
      </div>
    </div>

    <div class="panel right">
      <b>Properties</b>
      <div class="card" style="margin-top:8px; display:grid; gap:10px;">
        <label>Name <input id="name" /></label>
        <label>Pos X <input id="x" type="number" /></label>
        <label>Pos Y <input id="y" type="number" /></label>
        <label>Pos Z <input id="z" type="number" /></label>
        <label>Script (Luaっぽく書ける) <textarea id="code"></textarea></label>
      </div>
    </div>
  </div>

  <script>
    const uid = () => Math.random().toString(36).slice(2,10);
    let nodes = [
      { id:"p1", name:"Part", pos:{x:0,y:1,z:0}, code:"print('hello')" }
    ];
    let selectedId = "p1";

    const $ = (id) => document.getElementById(id);
    const explorerEl = $("explorer");
    const nameEl = $("name");
    const xEl = $("x"); const yEl = $("y"); const zEl = $("z");
    const codeEl = $("code");

    function renderExplorer(){
      explorerEl.innerHTML = "";
      nodes.forEach(n => {
        const div = document.createElement("div");
        div.className = "item" + (n.id===selectedId ? " active" : "");
        div.textContent = n.name;
        div.onclick = () => { selectedId = n.id; syncProps(); renderExplorer(); };
        explorerEl.appendChild(div);
      });
    }

    function getSelected(){
      return nodes.find(n => n.id===selectedId);
    }

    function syncProps(){
      const n = getSelected();
      if(!n) return;
      nameEl.value = n.name;
      xEl.value = n.pos.x;
      yEl.value = n.pos.y;
      zEl.value = n.pos.z;
      codeEl.value = n.code || "";
    }

    function applyProps(){
      const n = getSelected();
      if(!n) return;
      n.name = nameEl.value;
      n.pos.x = Number(xEl.value);
      n.pos.y = Number(yEl.value);
      n.pos.z = Number(zEl.value);
      n.code = codeEl.value;
      renderExplorer();
    }

    ["input","change"].forEach(evt=>{
      [nameEl,xEl,yEl,zEl,codeEl].forEach(el => el.addEventListener(evt, applyProps));
    });

    $("add").onclick = () => {
      const id = uid();
      nodes.push({ id, name:"Part", pos:{x:0,y:1,z:0}, code:"" });
      selectedId = id;
      renderExplorer(); syncProps();
    };

    $("save").onclick = () => {
      localStorage.setItem("project", JSON.stringify(nodes));
      alert("保存した");
    };
    $("load").onclick = () => {
      const raw = localStorage.getItem("project");
      if(!raw) return alert("保存データなし");
      nodes = JSON.parse(raw);
      selectedId = nodes[0]?.id || "";
      renderExplorer(); syncProps();
      alert("読み込んだ");
    };

    renderExplorer(); syncProps();
  </script>
</body>
</html>
